# Halo é™æ€ç½‘é¡µæœåŠ¡æ’ä»¶

è¿™æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨ Halo æ‰˜ç®¡é™æ€ç½‘é¡µçš„æ’ä»¶ï¼Œå¯ä»¥å°†é™æ€ç½‘é¡µä¸Šä¼ åˆ° Haloï¼Œç„¶åæä¾›è®¿é—®è·¯ç”±ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæ­¤æ’ä»¶è¿˜é…å¥—æä¾›äº†ä¸€ä¸ª CLI å·¥å…·ï¼Œç”¨äºåœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œé€šè¿‡ CLI å¿«é€Ÿå‘å¸ƒåˆ° Halo æœåŠ¡ï¼Œæˆ–è€…ä¸ GitHub Actions ç­‰ CI/CD å·¥å…·é›†æˆï¼Œä¸€å®šç¨‹åº¦ä¸Šå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ“¦ **é™æ€ç½‘é¡µæ‰˜ç®¡** - åœ¨ Halo ä¸­æ‰˜ç®¡ä»»æ„é™æ€ç½‘é¡µ
- ğŸ”„ **ç‰ˆæœ¬ç®¡ç†** - è‡ªåŠ¨ä¸ºæ¯æ¬¡ä¸Šä¼ åˆ›å»ºç‰ˆæœ¬ï¼Œæ”¯æŒç‰ˆæœ¬åˆ‡æ¢å’Œå›æ»š
- ğŸ—‘ï¸ **è‡ªåŠ¨æ¸…ç†** - å¯é…ç½®ä¿ç•™ç‰ˆæœ¬æ•°ï¼Œè‡ªåŠ¨åˆ é™¤æ—§ç‰ˆæœ¬
- ğŸ› ï¸ **CLI å·¥å…·** - é€šè¿‡å‘½ä»¤è¡Œå¿«é€Ÿéƒ¨ç½²
- ğŸ” **CI/CD é›†æˆ** - è½»æ¾ä¸ GitHub Actions ç­‰å·¥å…·é›†æˆ
- ğŸ“ **å¯è§†åŒ–ç¼–è¾‘** - åœ¨çº¿ç¼–è¾‘é™æ€é¡µé¢å†…å®¹ï¼ˆå®éªŒæ€§åŠŸèƒ½ï¼‰

## âš ï¸ å…³äºç¼“å­˜çš„æ³¨æ„äº‹é¡¹

ç”±äº Halo é»˜è®¤ä¸ºé™æ€èµ„æºæ·»åŠ äº†ç¼“å­˜ç­–ç•¥ï¼Œæ‰€ä»¥åœ¨æ›´æ–°é™æ€èµ„æºæ—¶å¯èƒ½ä¼šå‡ºç°ç¼“å­˜é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³ï¼š

### è®¾ç½® Halo çš„é™æ€èµ„æºç¼“å­˜ç­–ç•¥ï¼ˆæ¨èï¼‰

å°† Halo çš„ Cache-Control è®¾ç½®ä¸º `no-cache`ï¼Œå¼€å¯ä¹‹åä¼šç¦æ­¢åœ¨æµè§ˆå™¨ç¼“å­˜èµ„æºï¼Œä½†ä»ç„¶ä¼šç»è¿‡æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼ˆåå•†ç¼“å­˜éªŒè¯ï¼‰ï¼š

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Docker æˆ–è€… Docker Composeï¼Œåœ¨å¯åŠ¨å‚æ•°é…ç½®ä¸­æ·»åŠ  `--spring.web.resources.cache.cachecontrol.no-cache=true` å¹¶é‡å»ºå®¹å™¨å³å¯ï¼Œç¤ºä¾‹ï¼š

```yaml
services:
  halo:
    image: registry.fit2cloud.com/halo/halo:2.20
    ...
    command:
      - --spring.web.resources.cache.cachecontrol.no-cache=true
```

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Jar æ–‡ä»¶éƒ¨ç½²ï¼Œåœ¨ `application.yaml` ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```yaml
spring:
  ...
  web:
    resources:
      cache:
        cachecontrol:
          no-cache: true
```

### æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜

ç¼“å­˜å¯èƒ½å­˜åœ¨äºï¼š

- æµè§ˆå™¨ï¼šä¸€èˆ¬å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨é¡µé¢å³å¯ï¼Œæˆ–è€…æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…æ§åˆ¶å°ï¼Œå‹¾é€‰ç¦ç”¨ç¼“å­˜å¹¶åˆ·æ–°ä¸€æ¬¡ã€‚
- Nginxï¼šå¦‚æœå¼€å¯äº† Nginx åå‘ä»£ç†ç¼“å­˜ï¼Œå¯èƒ½éœ€è¦åŒæ—¶æ¸…é™¤ Nginx ç¼“å­˜ã€‚
- CDNï¼šå¦‚æœä½¿ç”¨äº† CDNï¼Œå¯èƒ½éœ€è¦æ¸…é™¤ CDN ç¼“å­˜ã€‚

## é¢„è§ˆ

![é¡¹ç›®](./images/plugin-static-pages-projects.png)

![æ–‡ä»¶åˆ—è¡¨](./images/plugin-static-pages-files-manager.png)

![CLI](./images/plugin-static-pages-cli-docs.png)

![å¯è§†åŒ–ç¼–è¾‘](./images/plugin-static-pages-visual-editor.png)

> å¯è§†åŒ–ç¼–è¾‘ä¸ºå®éªŒæ€§åŠŸèƒ½ï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼Œæ·»åŠ è¿™ä¸ªåŠŸèƒ½ä¹Ÿæ˜¯ä¸º Halo æœ¬èº«æ¢ç´¢å¯è§†åŒ–ç¼–è¾‘é¡µé¢çš„å®ç°æ–¹æ¡ˆã€‚

## å®‰è£…

1. https://www.halo.run/store/apps/app-gFkMn
2. https://github.com/ruibaby/plugin-static-pages/releases

## ä½¿ç”¨

### åˆ›å»ºé¡¹ç›®

![åˆ›å»ºé¡¹ç›®](./images/plugin-static-pages-create-project.png)

- **åç§°**ï¼šé¡¹ç›®åç§°ï¼Œå¯ä»¥éšæ„å¡«å†™ã€‚
- **ç›®å½•**ï¼šé¡¹ç›®çš„ç›®å½•ï¼Œç”¨äºå­˜æ”¾é¡¹ç›®çš„æ–‡ä»¶å’Œç”Ÿæˆè®¿é—®åœ°å€ï¼Œç›®å‰åªèƒ½æŒ‚è½½åˆ° Halo ç½‘ç«™çš„äºŒçº§ç›®å½•ã€‚

    éœ€è¦æ³¨æ„ï¼Œç”±äºç›®å‰é™æ€ç½‘é¡µåªèƒ½æŒ‚è½½åˆ° Halo ç½‘ç«™çš„äºŒçº§ç›®å½•ï¼Œä¸æ”¯æŒç»‘å®šåŸŸåï¼Œæ‰€ä»¥è¯·ç‰¹åˆ«æ³¨æ„ç½‘é¡µä¸Šçš„èµ„æºæŒ‡å‘ã€‚

    å¦‚æœä½ æ˜¯è‡ªå·±ç¼–å†™çš„çº¯ HTML é¡µé¢ï¼Œå¼•å…¥èµ„æºå»ºè®®åŠ ä¸Šæ­¤ç›®å½•åï¼Œæ¯”å¦‚é¡¹ç›®ç›®å½•å¡«å†™ä¸º `foo` æ—¶ï¼Œå¼•å…¥èµ„æºçš„è·¯å¾„åº”è¯¥ä¸º `/foo/bar.js`ï¼Œæˆ–è€…ä½¿ç”¨ç›¸å¯¹äº HTML æ–‡ä»¶çš„è·¯å¾„ï¼Œæ¯”å¦‚ `./js/bar.js`ã€‚ä¸èƒ½å†™ä¸º `/js/bar.js`ï¼Œå› ä¸º `/` ç›¸å¯¹äº Halo æ ¹è·¯å¾„ã€‚

    å¦‚æœä½ çš„é™æ€ç½‘é¡µä½¿ç”¨æ„å»ºå·¥å…·æ„å»ºï¼Œå¯ä»¥æŸ¥é˜…æ„å»ºå·¥å…·çš„æ–‡æ¡£ï¼Œä¿®æ”¹åŸºç¡€è·¯å¾„ï¼Œæ¯”å¦‚ [Vite](https://cn.vitejs.dev/config/shared-options#base)ï¼š

    ```ts
    import { fileURLToPath, URL } from 'node:url'

    import { defineConfig } from 'vite'
    import Vue from '@vitejs/plugin-vue'

    export default defineConfig({
      // ä¿®æ”¹ä¸ºé¡¹ç›®ç›®å½•
      base: '/vue/',
      plugins: [Vue()],
      resolve: {
          alias: {
          '@': fileURLToPath(new URL('./src', import.meta.url))
          }
      }
    })
    ```

- **å›¾æ ‡**ï¼šé¡¹ç›®çš„å›¾æ ‡ï¼Œå¯ä»¥éšæ„å¡«å†™ã€‚
- **æè¿°**ï¼šé¡¹ç›®çš„æè¿°ï¼Œå¯ä»¥éšæ„å¡«å†™ã€‚
- **æœ€å¤§ç‰ˆæœ¬æ•°**ï¼šä¿ç•™çš„æœ€å¤§ç‰ˆæœ¬æ•°é‡ï¼Œé»˜è®¤ä¸º 10ã€‚è®¾ç½®ä¸º 0 è¡¨ç¤ºä¸é™åˆ¶ç‰ˆæœ¬æ•°é‡ã€‚å½“ä¸Šä¼ æ–°ç‰ˆæœ¬è¶…è¿‡æ­¤é™åˆ¶æ—¶ï¼Œæœ€æ—§çš„ç‰ˆæœ¬ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚
- **é‡å†™è§„åˆ™**ï¼šç”¨äºé‡å†™é¡µé¢çš„è¯·æ±‚ï¼Œå¯ä»¥é€‚ç”¨äºé™æ€é¡µé¢å­˜åœ¨å‰ç«¯çº§è·¯ç”±ç®¡ç†çš„æƒ…å†µï¼Œæ¯”å¦‚ SPA é¡µé¢å¯èƒ½åªæœ‰ä¸€ä¸ª index.html æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¿™é‡Œå°† **æº** è®¾ç½®ä¸º `/**`ï¼Œ**ç›®æ ‡** è®¾ç½®ä¸º `/index.html`ï¼Œè¿™æ ·å°±å¯ä»¥è®©æ‰€æœ‰é¡µé¢è¯·æ±‚éƒ½æŒ‡å‘ index.html æ–‡ä»¶ã€‚

### ç‰ˆæœ¬ç®¡ç†

æ­¤æ’ä»¶æ”¯æŒå®Œæ•´çš„ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ã€‚æ¯æ¬¡ä¸Šä¼ æ–‡ä»¶æ—¶éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œè®©æ‚¨å¯ä»¥ï¼š

- **ä¿ç•™å†å²ç‰ˆæœ¬**ï¼šæ‰€æœ‰ä¸Šä¼ éƒ½ä¼šè¢«ä¿å­˜ä¸ºç‹¬ç«‹ç‰ˆæœ¬
- **è½»æ¾å›æ»š**ï¼šå¯ä»¥éšæ—¶åˆ‡æ¢åˆ°ä»»æ„å†å²ç‰ˆæœ¬
- **è‡ªåŠ¨æ¸…ç†**ï¼šæ ¹æ®"æœ€å¤§ç‰ˆæœ¬æ•°"è®¾ç½®è‡ªåŠ¨åˆ é™¤æ—§ç‰ˆæœ¬
- **æŸ¥çœ‹ç‰ˆæœ¬å†å²**ï¼šåœ¨é¡¹ç›®è¯¦æƒ…çš„"ç‰ˆæœ¬ç®¡ç†"æ ‡ç­¾é¡µæŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬

**ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†ï¼š**

1. ä¸Šä¼ æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºæ–°ç‰ˆæœ¬
2. ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¼šè‡ªåŠ¨æ¿€æ´»
3. åœ¨"ç‰ˆæœ¬ç®¡ç†"æ ‡ç­¾é¡µå¯ä»¥ï¼š
   - æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬åŠå…¶åˆ›å»ºæ—¶é—´
   - æ¿€æ´»ä»»æ„ç‰ˆæœ¬ï¼ˆç½‘ç«™å†…å®¹ä¼šç«‹å³åˆ‡æ¢ï¼‰
   - åˆ é™¤ä¸éœ€è¦çš„ç‰ˆæœ¬ï¼ˆæ´»åŠ¨ç‰ˆæœ¬ä¸èƒ½åˆ é™¤ï¼‰

æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒï¼š[ç‰ˆæœ¬ç®¡ç†æ–‡æ¡£](./docs/VERSION_MANAGEMENT_zh-CN.md)

### ä¸Šä¼ æ–‡ä»¶

æ­¤æ’ä»¶æä¾›ä¸¤ç§ä¸Šä¼ æ–‡ä»¶çš„æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºæ‰‹åŠ¨åœ¨é¡µé¢ä¸Šä¼ å’Œé€šè¿‡ CLI å·¥å…·ä¸Šä¼ ã€‚

#### æ‰‹åŠ¨ä¸Šä¼ 

è¿›å…¥æ–‡ä»¶ç®¡ç†ä¹‹åï¼Œç‚¹å‡»å³ä¸Šè§’çš„ä¸Šä¼ å³å¯å‡ºç°ä¸Šä¼ æ–‡ä»¶çš„å¯¹è¯æ¡†ï¼Œé€‰æ‹©æ–‡ä»¶åå³å¯ä¸Šä¼ ã€‚

#### é€šè¿‡ CLI

ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨è€…ä¸Šä¼ æ–‡ä»¶å’ŒæŒç»­éƒ¨ç½²ï¼Œæ­¤æ’ä»¶æä¾›äº†ä¸€ä¸ªé…å¥—çš„ CLI å·¥å…·ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š

> æ­¤å·¥å…·ä½¿ç”¨ Node.js å¼€å‘ï¼Œæ‰€ä»¥éœ€è¦å®‰è£… Node.js ç¯å¢ƒã€‚

```bash
â¯ npx halo-static-pages-deploy-cli deploy --help
Usage: halo-static-pages-deploy deploy [options]

Deploy static pages

Options:
  -f, --file <path>        Specify an input file                    # æ–‡ä»¶è·¯å¾„
  -e, --endpoint <string>  Halo API endpoint                        # Halo çš„è®¿é—®åœ°å€
  -i, --id <string>        Static Page ID                           # é¡¹ç›® IDï¼Œå¯ä»¥åœ¨é¡¹ç›®è¯¦æƒ…ä¸­çœ‹åˆ°
  -t, --token <string>     Personal access token                    # Halo çš„ä¸ªäººä»¤ç‰Œï¼Œéœ€è¦å‹¾é€‰ é™æ€ç½‘é¡µé¡¹ç›® -> é¡¹ç›®èµ„æºä¸Šä¼  æƒé™
  -h, --help               display help for command
```

ç¤ºä¾‹ï¼š

```bash
npx halo-static-pages-deploy-cli deploy -e https://demo.halo.run -i project-FRGuW -t pat_abcd -f ./dist
```

æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ GitHub Actions å’Œæ­¤ CLI å®ç°è‡ªåŠ¨éƒ¨ç½²ï¼ŒGitHub Actions ç¤ºä¾‹ï¼š

```yaml
name: Build and Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - uses: pnpm/action-setup@v3
        with:
          version: 8
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'
      - name: Install dependencies
        run: pnpm install
      - name: Build
        run: pnpm build
      - name: Deploy to Halo # å…³é”®æ­¥éª¤
        run: |
          npx halo-static-pages-deploy-cli deploy -e ${{ secrets.ENDPOINT }} -i ${{ secrets.ID }} -t ${{ secrets.PAT }} -f dist
```

éœ€è¦æ³¨æ„ï¼Œä½ éœ€è¦åœ¨ä»“åº“çš„ Secrets ä¸­æ·»åŠ  `ENDPOINT`ã€`ID` å’Œ `PAT` ä¸‰ä¸ªå˜é‡ï¼Œåˆ†åˆ«å¯¹åº” Halo ç½‘ç«™åœ°å€ã€é¡¹ç›® ID å’Œä¸ªäººä»¤ç‰Œï¼ˆéœ€è¦å‹¾é€‰ **é™æ€ç½‘é¡µé¡¹ç›® -> é¡¹ç›®èµ„æºä¸Šä¼ ** æƒé™ï¼‰ï¼Œ**è¯·ä¸è¦å°†è¿™äº›æ•æ„Ÿä¿¡æ¯æš´éœ²åœ¨å…¬å¼€ä»“åº“ä¸­**ã€‚
